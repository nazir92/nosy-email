language: java 
dist: trusty
jdk: oraclejdk8


addons:
  sonarcloud:
    organization: "notification-system"
    token:
      secure: "T8rhO/GPpV3sDm2EkaCSEVSX8U0gu7UGPqYlDaYEnmCXI0Ki2+AubPALfonc1FuUe+MkIsf5/QZukLhB7IBcUa30OPXBKsmfNn0AGkCZYM5a1rEQqncNE6c71dWsSXmWGk8yIbUtpbPIaScQQC5NSc2kMDAy0nQtHQFc88l+mpwhI+brT1f97Z//LluRY478jbpvfPvtuV0jF79LPvykk7X9eLeuzYGlOKXiaKQoTPGz0FV0rtYl8kATY26iI7ybX/HCDICRI4oUcAKwjUX2AQ9MdTHg9FOd/UI7XIk0EM4e4YPUwuenee4XrwMbpBXxos7WJtCv0iWrNXLfzaFLSXB3+wnJzlxZm0jnLECpP3UQymTAT1XWFians9Sikv+B3ZFoKtS80U8PjlCYthgflltBnbq9CVayvpIqfMgm2ahzIiBLFOV+3mpWIs0mMMH1swWIknnnJQA09O4+6on8gpyCh25rDykUBNlYsD+fOM6iNTTtx2Epf78zborxfdaieWMWt5K9Fiti49mBlv2KecrKesHogGxtf1orqLOOpFAwkNmh7tzdtskBNoRQPmwxfL1Up2QZSYKLj9B7K/RiNa/OSX8lWXPj6nPA8u6MKKqzKtyD/rPi3EdtN0YTeMuFe2VoaXOUwzOvzaycDilwZk5Ihs6MRnmBJLej+SECiCE="


script:
  # JaCoCo is used to have code coverage, "-Pcoverage" activates the maven profile in the pom.xml
  - ./mvnw clean install -B
  - ./mvnw clean org.jacoco:jacoco-maven-plugin:prepare-agent package sonar:sonar

cache:
  directories:
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'
    
services:
  - docker

after_success:
   - docker login -u $DOCKER_USER -p $DOCKER_PASS
   - docker build -t $IMAGE_TAG .
   - docker push $IMAGE_TAG
